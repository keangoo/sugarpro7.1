nv.models.funnel=function(){var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,x=d3.scale.ordinal(),y=d3.scale.linear(),id=Math.floor(Math.random()*10000),getX=function(d){return d.x;},getY=function(d){return d.y;},forceY=[0],clipEdge=true,delay=1200,xDomain,yDomain,fmtValueLabel=function(d){return d.y;},color=nv.utils.defaultColor(),fill=color,classes=function(d,i){return'nv-group nv-series-'+i;},dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove');var x0,y0;function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,container=d3.select(this),labelBoxWidth=20;data=d3.layout.stack().offset('zero').values(function(d){return d.values;}).y(getY)
(data);data=data.map(function(series,i){series.values=series.values.map(function(point){point.series=i;return point;});return series;});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0};});});x.domain(d3.merge(seriesData).map(function(d){return d.x;})).rangeBands([0,availableWidth],0.1);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return d.y+d.y0;}).concat(forceY))).range([availableHeight,0]);if(x.domain()[0]===x.domain()[1]||y.domain()[0]===y.domain()[1])singlePoint=true;if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-funnel').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-funnel');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');chart.gradient=function(d,i,p){return nv.utils.colorLinearGradient(d,id+'-'+i,p,color(d,i),wrap.select('defs'));};gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var w=Math.min(availableHeight/1.1,availableWidth-40),r=(((w/3)-w)/ 2)/ availableHeight,c=availableWidth/2;var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d;},function(d){return d.key;});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);d3.transition(groups.exit()).duration(0).selectAll('polygon.nv-bar').delay(function(d,i){return i*delay/ data[0].values.length;}).attr('points',function(d){var w0=(r*y(d.y0))+w/2,w1=(r*y(d.y0+d.y))+w/2;return((c-w0)+','+0+' '+
(c-w1)+','+0+' '+
(c+w1)+','+0+' '+
(c+w0)+','+0);}).remove();d3.transition(groups.exit()).duration(0).selectAll('g.nv-label-value').delay(function(d,i){return i*delay/ data[0].values.length;}).attr('y',0).style('fill-opacity',1e-6).attr('transform','translate('+c+',0)').remove();d3.transition(groups.exit()).duration(0).selectAll('text.nv-label-group').delay(function(d,i){return i*delay/ data[0].values.length;}).attr('y',0).style('fill-opacity',1e-6).attr('transform','translate('+availableWidth+',0)').remove();groups.attr('class',function(d,i){return this.getAttribute('class')||classes(d,i);}).classed('hover',function(d){return d.hover;}).attr('fill',function(d,i){return this.getAttribute('fill')||fill(d,i);}).attr('stroke',function(d,i){return this.getAttribute('fill')||fill(d,i);});d3.transition(groups).duration(0).style('stroke-opacity',1).style('fill-opacity',1);var funs=groups.selectAll('polygon.nv-bar').data(function(d){return d.values;});var funsEnter=funs.enter().append('polygon').attr('class','nv-bar positive').attr('points',function(d){var w0=(r*y(d.y0))+w/2,w1=(r*y(d.y0+d.y))+w/2;return((c-w0)+','+0+' '+
(c-w1)+','+0+' '+
(c+w1)+','+0+' '+
(c+w0)+','+0);});d3.transition(funs).duration(0).delay(function(d,i){return i*delay / data[0].values.length;}).attr('points',function(d){var w0=(r*y(d.y0))+w/2,w1=(r*y(d.y0+d.y))+w/2;return((c-w0)+','+y(d.y0)+' '+
(c-w1)+','+y(d.y0+d.y)+' '+
(c+w1)+','+y(d.y0+d.y)+' '+
(c+w0)+','+y(d.y0));});var lblValue=groups.selectAll('.nv-label-value').data(function(d){return d.values;});var lblValueEnter=lblValue.enter().append('g').attr('class','nv-label-value').attr('transform','translate('+c+',0)');lblValueEnter.append('text').attr('x',0).attr('y',5).attr('text-anchor','middle').text(function(d){return fmtValueLabel(d);}).attr('stroke','none').style('fill','#fff');lblValue.selectAll('text').each(function(d,i){var width=this.getBBox().width+20;if(width>labelBoxWidth){labelBoxWidth=width;}});d3.transition(lblValue).duration(0).delay(function(d,i){return i*delay / data[0].values.length;}).attr('transform',function(d){return'translate('+c+','+(y(d.y0+d.y/2))+')';});var lblGroup=groups.selectAll('text.nv-label-group').data(function(d){return[{y:d.values[0].y,y0:d.values[0].y0,key:d.count}];});var lblGroupEnter=lblGroup.enter().append('text').attr('class','nv-label-group').attr('x',0).attr('y',0).attr('dx',-10).attr('dy',5).attr('text-anchor','middle').text(function(d){return d.key;}).attr('stroke','none').style('fill','black').style('fill-opacity',1e-6).attr('transform','translate('+availableWidth+',0)');d3.transition(lblGroup).duration(0).delay(function(d,i){return i*delay / data[0].values.length;}).style('fill-opacity',1).attr('transform',function(d){return'translate('+availableWidth+','+(y(d.y0+d.y/2))+')';});funs.on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(data.length / 2)/ data.length),y(getY(d,i)+d.y0)],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({value:getY(d,i),point:d,series:data[d.series],pointIndex:i,seriesIndex:d.series,e:d3.event});}).on('mousemove',function(d,i){dispatch.elementMousemove({point:d,pointIndex:i,pos:[d3.event.pageX,d3.event.pageY],id:id});}).on('click',function(d,i){dispatch.elementClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(data.length / 2)/ data.length),y(getY(d,i)+d.y0)],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({value:getY(d,i),point:d,series:data[d.series],pos:[x(getX(d,i))+(x.rangeBand()*(data.length / 2)/ data.length),y(getY(d,i)+d.y0)],pointIndex:i,seriesIndex:d.series,e:d3.event});d3.event.stopPropagation();});x0=x.copy();y0=y.copy();});return chart;}
chart.dispatch=dispatch;chart.color=function(_){if(!arguments.length)return color;color=_;return chart;};chart.fill=function(_){if(!arguments.length)return fill;fill=_;return chart;};chart.classes=function(_){if(!arguments.length)return classes;classes=_;return chart;};chart.gradient=function(_){if(!arguments.length)return gradient;gradient=_;return chart;};chart.x=function(_){if(!arguments.length)return getX;getX=_;return chart;};chart.y=function(_){if(!arguments.length)return getY;getY=_;return chart;};chart.margin=function(_){if(!arguments.length)return margin;margin=_;return chart;};chart.width=function(_){if(!arguments.length)return width;width=_;return chart;};chart.height=function(_){if(!arguments.length)return height;height=_;return chart;};chart.xScale=function(_){if(!arguments.length)return x;x=_;return chart;};chart.yScale=function(_){if(!arguments.length)return y;y=_;return chart;};chart.xDomain=function(_){if(!arguments.length)return xDomain;xDomain=_;return chart;};chart.yDomain=function(_){if(!arguments.length)return yDomain;yDomain=_;return chart;};chart.forceY=function(_){if(!arguments.length)return forceY;forceY=_;return chart;};chart.id=function(_){if(!arguments.length)return id;id=_;return chart;};chart.delay=function(_){if(!arguments.length)return delay;delay=_;return chart;};chart.clipEdge=function(_){if(!arguments.length)return clipEdge;clipEdge=_;return chart;};chart.fmtValueLabel=function(_){if(!arguments.length)return fmtValueLabel;fmtValueLabel=_;return chart;};return chart;}